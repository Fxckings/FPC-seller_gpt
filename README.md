# AI Assistant Plugin для FunPayCardinal

AI-ассистент для автоматических ответов покупателям с использованием LangChain.

## Возможности

- Ответы только на сообщения с командой `!вопрос <текст>`
- История переписки (10 последних сообщений по умолчанию)
- Поддержка Groq и Mistral через LangChain
- Автоматическое извлечение информации о товаре
- Кэширование контекста товаров
- Гибкая настройка через Telegram-бот

## Установка

1. Скопируйте папку `ai_assistant` в `plugins/`
2. Установите зависимости:
```bash
pip install -r plugins/requirements.txt
```

3. Получите API ключ:
   - Groq: https://console.groq.com/keys
   - Mistral: https://console.mistral.ai/api-keys

4. Настройте конфигурацию через Telegram-бот или вручную отредактируйте `storage/plugins/ai_assistant.json`

## Использование

Покупатель пишет: `!вопрос Какая цена товара?`
Бот автоматически ответит с учетом контекста товара и истории переписки.

## Настройки

- **Включен** - активация/деактивация плагина
- **Отвечать ЧС** - отвечать пользователям из черного списка
- **Команда** - префикс команды (по умолчанию `!вопрос`)
- **Провайдер** - выбор между Groq и Mistral
- **Системный промпт** - инструкции для AI

## Архитектура
```
ai.py              # Точка входа плагина
ai_assistant/
├── core/
│   ├── config.py         # Управление конфигурацией
│   ├── ai_manager.py     # LangChain интеграция
│   └── message_processor.py  # Обработка сообщений
├── ui/
│   └── telegram_handler.py   # Telegram UI
└── utils/
    ├── constants.py      # Константы
    └── lot_fetcher.py    # Получение информации о товарах
```

## LangChain Features

- `InMemoryChatMessageHistory` - хранение истории чата
- `ChatGroq` / `ChatMistralAI` - провайдеры моделей
- Автоматическая обрезка истории при превышении лимита
- Контекстные сообщения с информацией о товаре

## Требования

- Python 3.8+
- FunPayCardinal
- langchain >= 0.3.13 (1.0.0)
- langchain-groq >= 0.2.1 (1.0.0)
- langchain-mistralai >= 0.2.2 (1.0.0)

## Безопасность

- API ключи хранятся в конфигурации
- Валидация всех входных данных
- Защита от инъекций путей
- Обработка исключений на всех уровнях

## Производительность

- Кэширование информации о товарах
- Ленивая инициализация провайдеров
- Ограничение истории сообщений
- Эффективное использование памяти
